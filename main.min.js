console.log("preparing...");const{Client:e,Events:t,GatewayIntentBits:s,WebhookClient:a,EmbedBuilder:i,PresenceUpdateStatus:n,GuildMember:r,REST:o,Routes:c,Collection:l,AttachmentBuilder:d,Partials:m}=require("discord.js"),{joinVoiceChannel:h,createAudioPlayer:u,NoSubscriberBehavior:g,createAudioResource:$,AudioPlayerStatus:p}=require("@discordjs/voice"),{tukyn:_}=require("./config.json"),fs=require("node:fs"),path=require("node:path"),{REPL_MODE_SLOPPY:f}=require("repl"),yaml=require("js-yaml"),os=require("os-utils"),request=require("request"),nodeHtmlToImage=require("node-html-to-image"),wait=require("node:timers/promises").setTimeout;require("dotenv").config();const http=require("http"),express=require("express"),wapp=express(),shapp=express(),cors=require("cors"),exec=require("child_process").exec,iconv=require("iconv-lite"),ffmpeg=require("fluent-ffmpeg"),twemoji=require("twemoji"),{lc:y,x:b,createStatFileIfItDoesntExists:w,getStat:S,setStat:v,setStatIfDoesntExists:k,unlockAchievement:x,addXP:j,getCoin:T,addCoin:I,ix:q,ep:F,Lynst:C,getRank:R,lyns:E,rankTopPercentile:N,getLoginSteak:M,getRequiredXP:D,uz:L,randASCIIstring:A,ctx:U,xtc:O,getRate:P,l:H,isJSON:z,ln:G,stp:J,dws:W,lci:Y,toHiragana:B,mir:K,hash:X,isTL:V,TLs:Q,noWeb:Z,getBadges:ee,migrateRepostFeaturePostDataFileFromFxxkingCSVToGodJSONWithJustASingleLineOfNodejsCodeSoUseThis:et}=require("./fn"),client=new e({intents:[s.Guilds,s.GuildMessages,s.MessageContent,s.GuildMessageReactions,s.GuildMembers,s.GuildVoiceStates],partials:[m.Message,m.Channel,m.Reaction]});wapp.use(express.static(path.join(__dirname,"htdocs"))),wapp.use(express.urlencoded({extended:!0})),wapp.use(cors({origin:!0,credentials:!0})),wapp.get("/",(e,t)=>{t.status(200).send("i'm okay for now.")}),wapp.post("/",(e,t)=>{console.log(e),t.send("Done")}),wapp.listen(3728,()=>{console.log("Server running: ftweb (https://first.treron.jp/)")}),shapp.use(cors({origin:!0,credentials:!0})),shapp.listen(19377,()=>{console.log("Server running: share (https://share.treron.jp)")});const repostEmojiId="1274321686338076775",likeEmojiId="1274996409048764490",bookmarkEmojiId="1274996408012767341",tms=new Date().getTime(),clientId="1062340451966914580",guildId="1227213276576874558";client.commands=new l;const foldersPath=path.join(__dirname,"commands"),commandFolders=fs.readdirSync(foldersPath),commands=[],gcmd=[];for(const folder of commandFolders){let es=path.join(foldersPath,folder),ea=fs.readdirSync(es).filter(e=>e.endsWith(".js"));for(let ei of ea){let en=path.join(es,ei),eo=require(en);"data"in eo&&"execute"in eo?client.commands.set(eo.data.name,eo):console.log(`[WARNING] The command at ${en} is missing a required "data" or "execute" property.`)}}for(const folder of commandFolders){let ec=path.join(foldersPath,folder),el=fs.readdirSync(ec).filter(e=>e.endsWith(".js"));for(let ed of el){let em=path.join(ec,ed),eh=require(em);"data"in eh&&"execute"in eh?"heart.js"===ed?gcmd.push(eh.data.toJSON()):commands.push(eh.data.toJSON()):console.log(`[WARNING] The command at ${em} is missing a required "data" or "execute" property.`)}}const cc=[{name:"connect",description:"connect and set tts where voice channel you're currently in"},{name:"disconnect",description:"disconnect and stop tts"}];cc.forEach(e=>commands.push(e));const rest=new o().setToken(_);(async()=>{try{console.log(`Started refreshing ${commands.length} application (/) commands.`);let e=await rest.put(c.applicationGuildCommands(clientId,guildId),{body:commands});console.log(`Successfully reloaded ${e.length} application (/) commands.`)}catch(t){console.error(t)}})(),(async()=>{try{console.log(`Started refreshing ${gcmd.length} application (/) commands.`);let e=await rest.put(c.applicationCommands(clientId),{body:gcmd});console.log(`Successfully reloaded ${e.length} application (/) commands.`)}catch(t){console.error(t)}})();const{GoogleGenerativeAI:eu,HarmCategory:eg,HarmBlockThreshold:e$}=require("@google/generative-ai"),safetySettings=[{category:eg.HARM_CATEGORY_HARASSMENT,threshold:e$.BLOCK_ONLY_HIGH},{category:eg.HARM_CATEGORY_HATE_SPEECH,threshold:e$.BLOCK_ONLY_HIGH},{category:eg.HARM_CATEGORY_SEXUALLY_EXPLICIT,threshold:e$.BLOCK_ONLY_HIGH},{category:eg.HARM_CATEGORY_DANGEROUS_CONTENT,threshold:e$.BLOCK_LOW_AND_ABOVE},],apiKey=process.env.GEMINI_API_KEY,genAI=new eu(apiKey),model=genAI.getGenerativeModel({model:"tunedModels/firstreron-v17-tfzuidmn1e36"}),generationConfig={temperature:1,topP:.95,topK:64,maxOutputTokens:8192,responseMimeType:"text/plain"};async function genAi(e){let t=model.startChat({generationConfig,safetySettings:safetySettings,history:[]}),s=await t.sendMessage(e),a=await s.response.text();return await a.length<1&&(a="..."),await a}function suin(e){try{if(e.member.displayName===e.member.user.username)return e.member.displayName;return`${e.member.displayName} (@${e.member.user.username})`}catch(t){er(t);try{return e.author.username}catch(s){er(s);return}}}function er(e){console.error(`${new Date}:`),console.error(e);let t=new i().setColor(16711680).setTitle("Error detected!").setDescription(`\`\`\`
${e}
\`\`\``);client.channels.cache.get("1274414683675295796").send({content:"<:repost:1274321686338076775>",embeds:[t]})}function io(e){console.log(`${new Date} // ${e}`);let t=new i().setColor(1118754).setTitle("Some info").setDescription(`\`\`\`
${e}
\`\`\``);client.channels.cache.get("1274414683675295796").send({content:"<:repost:1274321686338076775>",embeds:[t]})}function hsvToHex(e,t,s){let a,i,n,r=Math.floor(6*e),o=6*e-r,c=s*(1-t),l=s*(1-o*t),d=s*(1-(1-o)*t);switch(r%6){case 0:a=s,i=d,n=c;break;case 1:a=l,i=s,n=c;break;case 2:a=c,i=s,n=d;break;case 3:a=c,i=l,n=s;break;case 4:a=d,i=c,n=s;break;case 5:a=s,i=c,n=l}let m=e=>{let t=Math.round(255*e).toString(16);return 1===t.length?"0"+t:t};return`#${m(a)}${m(i)}${m(n)}`}function i3d6(){return Math.round(5*Math.random())+1+(Math.round(5*Math.random())+1)+(Math.round(5*Math.random())+1)}function d100(){return Math.round(99*Math.random())+1}async function usdjpy(){let e=await getRequest({url:"https://www.gaitameonline.com/rateaj/getrate",json:!0}),t=e.quotes.find(e=>"USDJPY"===e.currencyPairCode).ask;console.log(`1 USD = ${t}`)}function getRequest(e){return new Promise((t,s)=>{request(e,(e,a,i)=>{e?s(e):t(i)})})}function changeRate(e){if("100"===e){let t=parseFloat(fs.readFileSync("./data/rate/100.txt"));1*t!==t&&(t=100),(t+=25*Math.random()-12.5)<=25&&(t+=2.5),t>=175&&(t-=2.5),fs.writeFileSync("./data/rate/100.txt",t.toString()),fs.writeFileSync("./htdocs/rate/100/index.html",`<html><head><style>body{text-align:center}</style></head><body><h4>rate:</h4><h1 id=r>${Math.round(100*t)/100}</h1><script src="script.js"></script></body></html>`);let s;try{s=JSON.parse(fs.readFileSync("./htdocs/rate/rate.json"))}catch(a){er(a),fs.writeFileSync("./htdocs/rate/rate.json","{}"),s={}}s["100"]=t,fs.writeFileSync("./htdocs/rate/rate.json",JSON.stringify(s,null,"	"))}}client.once(t.ClientReady,async e=>{let t=client.guilds.cache.get(guildId);t.channels.cache.get("1227216489199960157").messages.fetch({limit:100});let s={};s=await t.invites.fetch({cache:!1});let r=[],o=[],c={},l,m;try{try{let g=JSON.parse(fs.readFileSync("./data/texts.json"));if(new Date().getTime()-g.upped<=36e5){let f=setInterval(()=>{let e=new i().setColor(7506394).setTitle("UP TIME").setDescription("</dissoku up:828002256690610256> ".repeat(Math.round(5*Math.random()+5)));t.channels.cache.get("1275790994826334281").send({embeds:[e]}).then(()=>{let e=JSON.parse(fs.readFileSync("./data/texts.json"));e.upped=null,fs.writeFileSync("./data/texts.json",JSON.stringify(e,null,4)),clearInterval(f)})},36e5-new Date().getTime()+g.upped)}if(new Date().getTime()-g.bumped<=72e5){let q=setInterval(()=>{let e=new i().setColor(2406327).setTitle("BUMP TIME").setDescription("</bump:947088344167366698> ".repeat(Math.round(5*Math.random()+5)));t.channels.cache.get("1275790994826334281").send({embeds:[e]}).then(()=>{let e=JSON.parse(fs.readFileSync("./data/texts.json"));e.bumped=null,fs.writeFileSync("./data/texts.json",JSON.stringify(e,null,4)),clearInterval(q)})},72e5-new Date().getTime()+g.bumped)}g.TTS?.channelId&&N(g.TTS.channelId)}catch(F){console.error(F)}function C(e){let t=JSON.parse(fs.readFileSync("./data/texts.json"));c=e,t.TTS=e,fs.writeFileSync("./data/texts.json",JSON.stringify(t,null,4))}async function N(e){return l=h({channelId:e,guildId:t.id,adapterCreator:t.voiceAdapterCreator}),m=u(),console.log("connected"),c?.channelId!==e&&m.stop(),l.subscribe(m),C({channelId:e,tracks:[],np:-1}),m.play($("./data/240msNone.wav")),m.on(p.Idle,()=>{try{console.log("idle"),c.np++,C(c),c.tracks[c.np]&&m.play($(c.tracks[c.np]))}catch(e){console.error(e)}}),!0}client.on("interactionCreate",async e=>{if(e.isChatInputCommand()){let s=e.client.commands.get(e.commandName);if(!s)switch(e.commandName){case"connect":await N(e.channel.id);return;case"disconnect":try{m.stop(),l.destroy(),l=void 0,m=void 0,C({})}catch(a){console.error(a)}return;default:console.error(`No command matching ${e.commandName} was found.`);return}try{await s.execute(e)}catch(n){console.error(n),e.replied||e.deferred?await e.followUp({content:"There was an error while executing this command!",ephemeral:!0}):await e.reply({content:"There was an error while executing this command!",ephemeral:!0})}}else if(e.isAutocomplete()){let r=e.client.commands.get(e.commandName);if(!r){console.error(`No command matching ${e.commandName} was found.`);return}try{await r.autocomplete(e)}catch(o){console.error(o)}}else if(e.isButton()){let c=["1275043743149326428","1274696519538180096"];if("ja"===e.customId){let d=e.member.roles.cache.map(e=>e.id).filter(e=>c.includes(e));for(let h=0;h<d.length;h++)e.member.roles.remove(d[h]);e.member.roles.add("1275043743149326428"),y(e.member);let u=new i().setTitle(b("panel.addRole","ja_JP")).setDescription("<@&1275043743149326428>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[u],ephemeral:!0})}else if("en"===e.customId){let g=e.member.roles.cache.map(e=>e.id).filter(e=>c.includes(e));for(let $=0;$<g.length;$++)e.member.roles.remove(g[$]);e.member.roles.add("1274696519538180096"),y(e.member);let p=new i().setTitle(b("panel.addRole","en_US")).setDescription("<@&1274696519538180096>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[p],ephemeral:!0})}else if("yn"===e.customId){e.member.roles.remove("1274646925609795687"),e.member.roles.add("1274646873889570887");let _=y(e.member),f=new i().setTitle(b("panel.addRole",_)).setDescription("<@&1274646873889570887>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[f],ephemeral:!0})}else if("fn"===e.customId){e.member.roles.remove("1274646873889570887"),e.member.roles.add("1274646925609795687");let w=y(e.member),x=new i().setTitle(b("panel.addRole",w)).setDescription("<@&1274646925609795687>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[x],ephemeral:!0})}else if("wb"===e.customId){if(e.member.roles.cache.has("1286857846423556206")){e.member.roles.remove("1286857846423556206");let j=y(e.member),T=new i().setTitle(b("panel.removeRole",j)).setDescription("<@&1286857846423556206>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[T],ephemeral:!0})}else{e.member.roles.add("1286857846423556206");let q=y(e.member),F=new i().setTitle(b("panel.addRole",q)).setDescription("<@&1286857846423556206>").setColor(Math.round(16777215*Math.random()));e.reply({embeds:[F],ephemeral:!0})}}else if(e.customId.startsWith("creq")){if(e.message.interactionMetadata.user.id===e.user.id){let R=S(e.user.id),E=Y(e);if(new Date().getTime()-R.crts>=3e4){let M=parseInt(e.customId.replace(/^creq/,"")),D=R.crq.find(e=>e.id===M),L=await e.guild.members.fetch(D.target);k(L.id,"coinRequests",[]);let A=S(L.id),U=(A.coinRequests?.sort((e,t)=>t.id-e.id)?.at(0)?.id??0)+1,O={id:U,user:L.id,amount:D.amount,rid:M,from:e.user.id,timestamp:new Date().getTime()};A.coinRequests.push(O),v(L.id,"coinRequests",A.coinRequests),L.createDM();let P=y(L),H=new i().setAuthor({name:e.user.username,iconURL:e.member.displayAvatarURL()}).setTitle(b("command.request.dm.coinRequest",P)).setDescription(`${b("command.request.dm.requested",P).replace("<user>",`<@${e.user.id}>`).replace("<coins>",D.amount.toLocaleString())}${D.message?D.message.split("\n").map(e=>`
-# *${e}*`).join("\n"):""}`).setColor(Math.round(16777215*Math.random()));await L.send({embeds:[H],components:[{type:1,components:[{type:2,label:b("accept",P),style:3,custom_id:`cra${U}`},{type:2,label:b("decline",P),style:4,custom_id:`crd${U}`}]}]}),D.status="waiting",v(e.user.id,"crq",R.crq),await e.message.edit({embeds:[new i().setColor(8714888).setTitle(b("command.request.requestCompleted",E)).setDescription(`-# ***${D.amount.toLocaleString()} <:coin:1284070241005080606>***`)],components:[],content:""}),v(e.user.id,"crts",new Date().getTime())}else await e.reply({content:`${b("coolingDown",E)} (<t:${Math.round(R.crts/1e3+30)}:R>)`,ephemeral:!0})}}else if(e.customId.startsWith("crqx")){if(e.message.interactionMetadata.user.id===e.user.id){let z=parseInt(e.customId.replace(/^crqx/,"")),G=S(e.user.id);G.crq.find(e=>e.id===z).status="canceled",v(e.user.id,"crq",G.crq),await e.message.delete()}}else if(e.customId.startsWith("cra")){let J=parseInt(e.customId.replace(/^cra/,"")),W=S(e.user.id),B=W.coinRequests.find(e=>e.id===J),K=y(t.members.cache.get(e.user.id)),X=await t.members.fetch(B.from),V=y(X),Q=S(B.from),Z=Q.crq.find(e=>e.id===B.rid);if("waiting"===Z.status){let ee=I(e.user.id,-B.amount);ee?(await e.message.edit({embeds:[new i().setColor(6553516).setTitle(b("command.request.dm.transferSuccess",K)).setDescription(b("command.requested.dm.gave",K).replace("<user>",`<@${X.id}>`).replace("<coins>",B.amount.toLocaleString()))]}),I(X.id,B.amount),await X.createDM(),await X.send({embeds:[new i().setColor(7183868).setDescription(`${b("command.request.dm.accepted",V).replace("<user>",`<@${e.user.id}>`)}
-# ***${B.amount.toLocaleString()} <:coin:1284070241005080606>***
-# *requestId: \`${X.id}:${B.rid},${e.user.id}:${B.id}\`*`).setTitle(b("command.request.accepted.title",V))]}),Z.status="accepted",v(X.id,"crq",Q.crq),await e.update({components:[]})):await e.reply({content:b("command.request.dm.notEnoughCoins",K),ephemeral:!0})}}else if(e.customId.startsWith("crd")){let et=parseInt(e.customId.replace(/^crd/,"")),es=S(e.user.id);await e.message.delete();let ea=es.coinRequests.find(e=>e.id===et),ei=await t.members.fetch(ea.from),en=y(ei),eo=S(ei.id),ec=eo.crq.find(e=>e.id===ea.rid);"waiting"===ec.status&&(await ei.createDM(),await ei.send({embeds:[new i().setColor(16535118).setDescription(`${b("command.request.dm.declined",en).replace("<user>",`<@${e.user.id}>`)}
-# ***${ea.amount.toLocaleString()} <:coin:1284070241005080606>***
-# *requestId: \`${ei.id}:${ea.rid},${e.user.id}:${ea.id}\`*`).setTitle(b("command.request.declined.title",en))]}),ec.status="declined",v(ei.id,"crq",eo.crq))}}else if(e.isMessageContextMenuCommand()){let el=e.client.commands.get(e.commandName);if(!el){console.error(`No command matching ${e.commandName} was found.`);return}try{await el.execute(e)}catch(ed){console.error(ed),e.replied||e.deferred?await e.followUp({content:"There was an error while executing this command!",ephemeral:!0}):await e.reply({content:"There was an error while executing this command!",ephemeral:!0})}}}),eo(),setInterval(eo,6e4),console.log(`${e.user.tag}`),io("okay i woke up");try{async function D(e){console.log("yoo new tl lets gooo");let t=model.startChat({generationConfig,safetySettings:safetySettings,history:[]});try{let s=fs.readFileSync("./data/aipr.txt").toString(),a=Math.round(Math.random()*(s.split("\r\n").length-1)),i=await t.sendMessage(s.split("\r\n")[a]),n=await i.response.text(),r="";0!==a&&(r=`-# ___Q. ${s.split("\r\n")[a]}___
`),await n.length<1&&(n="..."),e.send({content:`${r}${await n}`}).then(e=>{e.react(likeEmojiId),e.react(repostEmojiId),e.react(bookmarkEmojiId),e.startThread({name:G(e.content,100)})})}catch(o){er(o)}}wapp.get("/stats",async(e,s)=>{if(console.log(e.query.id),e.query.id){let a=path.join(__dirname,"stats",`${e.query.id}.json`);if(fs.existsSync(a)){E(e.query.id);let i=JSON.parse(fs.readFileSync(a));i.coins=T(e.query.id),i.rank=R(e.query.id);let n=await t.members.fetch(e.query.id);console.log(n),n.roles.cache.has("1276543473083875410")&&!i.badges.includes("ltsl")&&i.badges.push("ltsl"),n.roles.cache.has("1276542660315844728")&&!i.badges.includes("ltsy")&&i.badges.push("ltsy"),delete i.cghistory,delete i.roles,delete i.lastLogin,delete i.items,delete i.pendingInvite,delete i.lbBanned,delete i.crq,delete i.coinsRequests,delete i.crts,(i={id:e.query.id,name:n.displayName,username:n.user.username,...i}).loginStreak=M(e.query.id),s.status(200).send(i)}else s.status(404).send("Stats not found.")}else s.status(400).send("Invalid params.")}),shapp.get("/*",async(e,s)=>{function a(e){return(e+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e){return e.replace(/^(?!\\)-# .+/gm,e=>`<small>${e.slice(3,e.length)}</small>`).replace(/^(?!\\)### .+/gm,e=>`<h3>${e.slice(4,e.length)}</h3>`).replace(/^(?!\\)## .+/gm,e=>`<h2>${e.slice(3,e.length)}</h2>`).replace(/^(?!\\)# .+/gm,e=>`<h1>${e.slice(2,e.length)}</h1>`).replace(/^\s*(?!\\)- .+/gm,e=>{let t=Math.floor((e.match(/^\s*-/)[0].length-1)/2),s;return t>0&&(s="list-style-type: circle;"),`<li style="left: ${24*t}px;${s}">${e.replace(/^\s*- /,"")}</li>`}).replace(/^\s*(?!\\)\* .+/gm,e=>`<li style="left: ${24*Math.floor((e.match(/^\s*\*/)[0].length-1)/2)}px;">${e.replace(/^\s*\* /,"")}</li>`).replace(/((?!\\)\*){2}[^\*]+\1{2}/g,e=>`<strong>${e.slice(2,e.length-2)}</strong>`).replace(/((?!\\)\*)[^\*]+\1/g,e=>`<i>${e.slice(1,e.length-1)}</i>`).replace(/((?!\\)_){2}[^_]+\1{2}/g,e=>`<u>${e.slice(2,e.length-2)}</u>`).replace(/((?!\\)_)[^_]+\1/g,e=>`<i>${e.slice(1,e.length-1)}</i>`).replace(/((?!\\)~){2}[^~]+\1{2}/g,e=>`<del>${e.slice(2,e.length-2)}</del>`).replace(/((?!\\)`){3}(?:[^`]|`(?!``))*\1{3}/g,e=>{let t=e.replace(/`/g,"");return t.split("\n").length<2?`<code class="cb">${t}</code>`:""===t.split("\n")[0]?`<code class="cb">${t}</code>`:(console.log(t.replace(/^.+\n/,"")),`<pre><code class="language-${t.split("\n")[0]} theme-dark cb">${t.replace(/^.+\n/,"")}</code></pre>`)}).replace(/((?!\\)`){1,2}[^`]+\1{1,2}/g,e=>`<code>${e.replace(/`/g,"")}</code>`).replace(/\n|\r/g,"<br>").replace(/(<\/h[1-3]>|<\/li>)<br>/g,e=>e.slice(0,5)).replace(/\|\|[^\|]+\|\|/g,e=>`<span class="spoiler">${e.slice(2,e.length-2)}</span>`).replace(/https?:\/\/[\w.?=&#%~\/-]+/g,e=>`<a href="${e}" target="_blank">${e}</a>`).replace(/\\\W/g,e=>e[1])}function n(e){return e.replace(/&lt;a?:\S+:\d+&gt;/g,e=>`<img src="https://cdn.discordapp.com/emojis/${e.match(/\d+/)[0]}" class="emoji">`)}function r(e){return o(e)}function o(e){return e.replace(/&lt;@!?\d+&gt;/g,e=>{let t=c.find(t=>t.id===e.replace("!","").match(/\d+/)[0]).name;return void 0===t&&(t=e),`<span class="mention">@${t}</span>`})}let c=e.url;if(/^\/([0-9a-z_.]{2,}|[^\/]+%23\d{4})\/\d+\/?$/i.test(c))try{let l=c.replace(/^\//,"").replace(/\/$/,"").split("/"),d=l[1],m=await t.channels.cache.get(Q.default).messages.fetch(d).catch(async e=>await t.channels.cache.get(Q.r18).messages.fetch(d)),h=await t.members.fetch(m.author.id).catch(async e=>{if(10007===e.code)return m.author;console.error(e)});if(l[0]!==encodeURIComponent(m.author.tag))s.redirect(307,c.replace(RegExp(`^/${l[0]}/`),`/${encodeURIComponent(m.author.tag)}/`));else if(h.user&&h?.roles?.cache?.has(Z)||S(m.author.id)?.roles?.includes(Z))s.status(403).send("the author doesn't want to make their messages public.");else{let u=m.reactions.cache,g=fs.readFileSync("./data/templates/share.html").toString().replace(/%content%/g,r(n(i(a(m.content)))).replace(/\n/g,"<br>")).replace(/%contentTitle%/g,m.content).replace(/%avatar%/g,h.displayAvatarURL()).replace(/%username%/g,m.author.tag).replace(/%displayName%/g,`${h.displayName}${await ee(h.user.id,4)?n(a(await ee(h.user.id,0))):""}`).replace(/%displayNameTitle%/g,h.displayName).replace(/%avatarDecorationAsset%/,m.author.avatarDecorationData?.asset??"").replace(/%reactionHTML%/g,e=>{let t="";return u.each(e=>t+=`<div class="m3qko p7oMc"><img class="reactionEmoji" src="${e.emoji.id?`https://cdn.discordapp.com/emojis/${e.emoji.id}.webp?size=32&quality=lossless`:`https://cdn.jsdelivr.net/gh/jdecked/twemoji@latest/assets/72x72/${twemoji.convert.toCodePoint(e.emoji.name)}.png`}"><div class="reactionCount">${e.count}</div></div>`),t});s.status(200).send(g)}}catch($){console.error($),s.status(400).send("something went wrong...")}else s.status(200).send(fs.readFileSync("./data/web/share/default.html").toString())}),t.channels.cache.get("1276129256547680309").messages.fetch("1276129798921523200"),client.on("messageReactionAdd",async(e,s)=>{try{console.log(`${e.message.id}, ${e.message.partial}`),e.message.partial||console.log(`${e.message.id}, ${e.message.content}, ${e.message.author.id}, ${e.message.member.id}`),e.message.author.bot||E(e.message.author.id),s.bot||E(s.id)}catch(n){er(n)}if(e.message.fetch(),e.emoji.id===repostEmojiId||"1274325288498499689"===e.emoji.id)try{if(e.message.fetch().then(async e=>{console.log(e)}),!s.bot){if(fs.readFileSync("./data/bl.txt").toString().split("\r\n").includes(e.message.channelId))io(`Repost requested in blacklisted channel! <#${e.message.channelId}>`);else{let r=e.message,o=JSON.parse(fs.readFileSync("./data/ri.json")).find(t=>e.message.id===t.created);o&&(r=await e.message.channel.messages.fetch(o.target));let c=y(r.member);try{let l;if(r.fetch().then(async e=>{l=await e.reactions.cache.get(repostEmojiId).count??1}),!r.author.bot){w(r.author.id),k(r.author.id,"grepost",0);let d=S(r.author.id).grepost;if(d++,v(r.author.id,"grepost",d),1===d){let m=r.member.roles.cache.has("1274646873889570887");x(r.author.id,"1reposted",c,m,50,"common")}if(100===d){let h=r.member.roles.cache.has("1274646873889570887");x(r.author.id,"100reposted",c,h,640,"uncommon")}j(r.author.id,Math.floor(5+(l??1)/2))}let u=y(r.guild.members.cache.get(s.id));if(!s.bot){w(s.id),k(s.id,"reposted",0);let g=S(s.id).reposted;if(g++,v(s.id,"reposted",g),1===g){let $=r.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"1repost",u,$,20,"common")}if(100===g){let p=r.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"100repost",u,p,240,"uncommon")}j(s.id,Math.floor(3+((l??1)-1)/3))}}catch(_){er(_)}console.log("Repost detected!");try{let f=JSON.parse(fs.readFileSync("./badges/_emojidata.json")),I=S(s.id),q=[],F="";for(let C=0;C<I.badges.length;C++)q.push(f[I.badges[C]]??"❓");if(t.members.cache.get(s.id).roles.cache.has("1276543473083875410")&&!I.badges.includes("ltsl")&&q.push(f.ltsl),t.members.cache.get(s.id).roles.cache.has("1276542660315844728")&&!I.badges.includes("ltsy")&&q.push(f.ltsy),q.length>0){F="";for(let R=0;R<q.length;R++)F=`${F} ${q[R]}`,console.log(q[R]);F=`${F} `}for(let N=0;N<2;N++)try{let M=O(r.channelId);M||(M=await P(r.channel));let D;D=new a({url:M});let L=r.channelId;r.member||r.fetch();let A=r?.member?.avatarURL(),U=r.author.displayAvatarURL(),G,J=`https://discord.com/channels/${r.channel.guildId}/${L}/${r.id}`,W=`-# ___ <:repost:${repostEmojiId}> ${b("post.reposted",c).replace("<user>",`<@!${s.id}>${F}`)}(${J}) / <t:${Math.round(r.createdTimestamp/1e3)}:R> ___
`;G=(W+r.content).length<=2e3?r.content:`${r.content.slice(0,199)}... [${b("post.showMore",c)}](${J})`;let Y=r.toJSON();if(Y.content=`${W}${G}`,Y.avatarURL=A??U,Y.username=suin(r),Y.allowedMentions={parse:[]},Y.nonce=8,Y.attachments=r.attachments,console.log(Y,Y.attachments),D.send(Y).then(e=>{r.editedTimestamp&&D.editMessage(e,e);let t=JSON.parse(fs.readFileSync("./data/ri.json"));fs.readFileSync("./data/ri.txt").toString()&&(t=t.concat(et(fs.readFileSync("./data/ri.txt").toString())),fs.writeFileSync("./data/ri.txt","")),t.push({target:r.id,reposter:s.id,created:e.id}),fs.writeFileSync("./data/ri.json",JSON.stringify(t,null,4))}),r.member.roles.cache.has("1274646873889570887")&&r.author.id!==s.id){io(`notify accepted!
${r.author.username}`),r.author.createDM();let B=new i().setColor(65449).setTitle(b("notify.notifications",c)).setDescription(`${b("notify.repost",c).replace("<user>",`<@!${s.id}>`).replace("<link>",r.url)}
${r.content.split("\n")[0]}`);r.member.send({embeds:[B]}).catch(e=>{er(e)})}break}catch(K){er(K);fs.readFileSync("./data/wht.txt").toString().replace(`${r.channelId}
${whurl}
`,""),await P(r.channel);continue}}catch(X){er(X)}}}}catch(V){er(V)}if(e.emoji.id===likeEmojiId||"1274995055106723880"===e.emoji.id)try{if(!s.bot&&!e.message.author.bot){let Q=y(e.message.member);try{let Z;if(!e.message.author.bot){w(e.message.author.id),k(e.message.author.id,"glike",0);let ee=S(e.message.author.id).glike;if(ee++,v(e.message.author.id,"glike",ee),ee>=1&&!S(e.message.author.id).achievements.includes("1liked")){let es=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"1liked",Q,es,50,"common")}if(ee>=100&&!S(e.message.author.id).achievements.includes("100liked")){let ea=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"100liked",Q,ea,810,"uncommon")}if(ee>=1e3&&!S(e.message.author.id).achievements.includes("1kliked")){let ei=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"1kliked",Q,ei,1260,"uncommon")}e.message.fetch().then(async t=>{if(Z=t.reactions.cache.get(likeEmojiId).count,12===Z&&1===e.message.content.length&&!e.message.author.bot){let s=y(e.message.member);if(w(e.message.author.id),!S(e.message.author.id).achievements.includes("1c12l")){let a=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"1c12l",s,a,1111,"godlike")}}}),j(e.message.author.id,10+(Z??0))}let en=y(e.message.guild.members.cache.get(s.id));if(!s.bot){w(s.id),k(s.id,"liked",0);let eo=S(s.id).liked;if(eo++,v(s.id,"liked",eo),eo>=1&&!S(e.message.author.id).achievements.includes("1like")){let ec=e.message.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"1like",en,ec,30,"common")}if(eo>=100&&!S(e.message.author.id).achievements.includes("100like")){let el=e.message.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"100like",en,el,320,"uncommon")}if(eo>=1e3&&!S(s.id).achievements.includes("1klike")){let ed=e.message.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"1klike",en,ed,640,"uncommon")}j(s.id,Math.floor(5+(Z??0)/2))}if(!e.message.author.bot&&!s.bot&&e.message.author.id===s.id&&(w(e.message.author.id),!S(e.message.author.id).achievements.includes("selflike"))){let em=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"selflike",Q,em,16,"uncommon")}}catch(eh){er(eh)}try{let eu=e.message.member.roles.cache.has("1274646873889570887")??S(e.message.author.id).roles.includes("1274646873889570887");if(eu&&e.message.author.id!==s.id){io(`notify accepted!
${e.message.author.username}`),e.message.author.createDM();let eg=new i().setColor(16324736).setTitle(b("notify.notifications",Q)).setDescription(`${b("notify.like",Q).replace("<user>",`<@!${s.id}>`).replace("<link>",`https://discord.com/channels/${e.message.channel.guildId}/${e.message.channelId}/${e.message.id}`)}
${e.message.content.split("\n")[0]}`);e.message.member.send({embeds:[eg]}).catch(t=>{er(t),er(e.message.author.username)})}}catch(e$){er(e$)}}}catch(ep){er(ep)}if(e.emoji.id===bookmarkEmojiId)try{if(!s.bot&&!e.message.author.bot){let e_=y(e.message.member);try{if(!e.message.author.bot){w(e.message.author.id),k(e.message.author.id,"gbm",0);let ef=S(e.message.author.id).gbm;if(ef++,v(e.message.author.id,"gbm",ef),ef>=1&&!S(e.message.author.id).achievements.includes("1bmd")){let e6=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"1bmd",e_,e6,60,"common")}}let e5=y(e.message.guild.members.cache.get(s.id));if(!s.bot){w(s.id),k(s.id,"bm",0);let e0=S(s.id).bm;if(e0++,v(s.id,"bm",e0),e0>=1&&!S(e.message.author.id).achievements.includes("1bm")){let e4=e.message.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"1bm",e5,e4,30,"common")}}}catch(e2){er(e2)}try{let ey=e.message.member.roles.cache.has("1274646873889570887")??S(e.message.author.id).roles.includes("1274646873889570887");if(ey&&e.message.author.id!==s.id){io(`notify accepted!
${e.message.author.username}`),e.message.author.createDM();let eb=new i().setColor(16324736).setTitle(b("notify.notifications",e_)).setDescription(`${b("notify.like",e_).replace("<user>",`<@!${s.id}>`).replace("<link>",`https://discord.com/channels/${e.message.channel.guildId}/${e.message.channelId}/${e.message.id}`)}
${e.message.content.split("\n")[0]}`);e.message.member.send({embeds:[eb]}).catch(t=>{er(t),er(e.message.author.username)})}}catch(e3){er(e3)}}}catch(e1){er(e1)}if("1276129256547680309"===e.message.channelId)try{if(!s.bot){let ew=y(e.message.guild.members.cache.get(s.id));if(w(s.id),!S(s.id).achievements.includes("work")){let e7=e.message.guild.members.cache.get(s.id).roles.cache.has("1274646873889570887");x(s.id,"work",ew,e7,1,"common")}j(s.id,1+T(s.id)/100)}}catch(e9){er(e9)}try{if(!e.message.author.bot){w(e.message.author.id);let eS,ev;e.message.fetch().then(async t=>{if(wait(36),eS=await t.reactions.cache.get(likeEmojiId).count??0,ev=await t.reactions.cache.get(repostEmojiId).count??0,console.log(`${eS}, ${ev}`),1===eS&&ev>=5&&!e.message.author.bot){let s=y(e.message.member);if(w(e.message.author.id),!S(e.message.author.id).achievements.includes("0l5r")){let a=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"0l5r",s,a,700,"epic")}}if(1===eS&&ev>=16&&!e.message.author.bot){let i=y(e.message.member);if(w(e.message.author.id),!S(e.message.author.id).achievements.includes("0l16r")){let n=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"0l16r",i,n,5e3,"godlike")}}if(("にゃーん"===e.message.content||"nyan"===e.message.content.toLowerCase)&&ev>=8&&!e.message.author.bot){let r=y(e.message.member);if(w(e.message.author.id),!S(e.message.author.id).achievements.includes("nyan8r")){let o=e.message.member.roles.cache.has("1274646873889570887");x(e.message.author.id,"nyan8r",r,o,222,"godlike")}}});let ek=await e.message.fetch().then(async e=>await e.member);H(ek??e.message.guild.members.cache.get(e.message.author.id)),H(e.message.guild.members.cache.get(s.id))}}catch(ex){er(ex)}try{s.bot||z(t.members.cache.get(s.id))}catch(ej){er(ej)}}),client.on("rateLimit",e=>{console.log(e)}),client.on("messageReactionRemove",async(e,t)=>{if(e.emoji.id===repostEmojiId||"1274325288498499689"===e.emoji.id)try{io("removing a repost..."),w(e.message.author.id),k(e.message.author.id,"grepost",0);let s=S(e.message.author.id).grepost;s--,v(e.message.author.id,"grepost",s),w(t.id),k(t.id,"reposted",0);let a=S(t.id).reposted;a--,v(t.id,"reposted",a);try{let i=JSON.parse(fs.readFileSync("./data/ri.json")),n=i.findIndex(s=>s.target===e.message.id&&s.reposter===t.id);n>=0&&((await e.message.channel.messages.fetch(i[n].created)).delete().then(e=>io(`${e?.id} deleted.`)),i.splice(n,1),fs.writeFileSync("./data/ri.json",JSON.stringify(i,null,4)))}catch(r){er(r)}}catch(o){er(o)}e.message.author.bot||E(e.message.author.id),t.bot||E(t.id)}),client.on("messageUpdate",async(e,s)=>{if(s.author.bot&&"761562078095867916"===s.author.id&&"dissoku up"===s.interaction.commandName){let a=s.embeds[0];if(15158332===a.color)io("huh upFail");else if(7506394===a.color){if(io("upSuccess!"),!s.interaction.user.bot){k(s.interaction.user.id,"up",0);let n=S(s.interaction.user.id);n.up++,v(s.interaction.user.id,"up",n.up),I(s.interaction.user.id,114*Math.round(51*Math.sqrt(n.up)))}let r=await t.members.fetch(s.interaction.user.id),o=y(r),c=new i().setColor(7506394).setDescription(b("bump.notify",o).replace("<time>",`<t:${Math.round(new Date().getTime()/1e3+3600)}:R>`));s.channel.send({embeds:[c]});let l=JSON.parse(fs.readFileSync("./data/texts.json"));l.upped=new Date().getTime(),fs.writeFileSync("./texts.json",JSON.stringify(l,null,4));let d=setInterval(()=>{let e=new i().setColor(7506394).setTitle("UP TIME").setDescription("</dissoku up:828002256690610256> ".repeat(Math.round(5*Math.random()+5)));t.channels.cache.get("1275790994826334281").send({embeds:[e]}).then(()=>{let e=JSON.parse(fs.readFileSync("./data/texts.json"));e.upped=null,fs.writeFileSync("./texts.json",JSON.stringify(e,null,4)),clearInterval(d)})},36e5)}}}),client.on("messageCreate",async e=>{if(e.author.bot){if("302050872383242240"===e.author.id){if("bump"===e.interaction.commandName){let s=e.embeds[0];if(2406327===s.color){if(io("bumpSuccess!"),!e.interaction.user.bot){k(e.interaction.user.id,"bumped",0);let a=S(e.interaction.user.id);a.bumped++,v(e.interaction.user.id,"bumped",a.bumped),I(e.interaction.user.id,Math.round(38147*Math.sqrt(a.bumped)))}let n=await t.members.fetch(e.interaction.user.id),r=y(n),l=new i().setColor(2406327).setDescription(b("bump.notify",r).replace("<time>",`<t:${Math.round(new Date().getTime()/1e3+7200)}:R>`));e.channel.send({embeds:[l]});let h=JSON.parse(fs.readFileSync("./data/texts.json"));h.bumped=new Date().getTime(),fs.writeFileSync("./texts.json",JSON.stringify(h,null,4));let u=setInterval(()=>{let e=new i().setColor(2406327).setTitle("BUMP TIME").setDescription("</bump:947088344167366698> ".repeat(Math.round(5*Math.random()+5)));t.channels.cache.get("1275790994826334281").send({embeds:[e]}).then(()=>{let e=JSON.parse(fs.readFileSync("./data/texts.json"));e.bumped=null,fs.writeFileSync("./texts.json",JSON.stringify(e,null,4)),clearInterval(u)})},72e5)}}}else"761562078095867916"===e.author.id&&"dissoku up"===e.interaction.commandName&&console.log(await e)}else{w(e.author.id),k(e.author.id,"posts",0);let g=S(e.author.id).posts;if(7!==e.type&&g++,v(e.author.id,"posts",g),g>=1&&!S(e.author.id).achievements.includes("1post")){let p=y(e.member),_=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"1post",p,_,50,"common")}if(g>=100&&!S(e.author.id).achievements.includes("100post")){let f=y(e.member),T=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"100post",f,T,90,"uncommon")}if(g>=500&&!S(e.author.id).achievements.includes("500post")){let q=y(e.member),F=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"500post",q,F,180,"uncommon")}if(g>=1e3&&!S(e.author.id).achievements.includes("1kpost")){let R=y(e.member),N=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"1kpost",R,N,900,"uncommon")}let M=new Date;if(M.setTime(e.createdTimestamp),console.log(M.getHours()),3>=M.getHours()||M.getHours()>=22)try{let D=y(e.member);if(!e.author.bot&&7!==e.type&&(w(e.author.id),!S(e.author.id).achievements.includes("nocturnal"))){let U=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"nocturnal",D,U,16,"uncommon")}}catch(O){er(O)}if(j(e.author.id,Math.floor(5+g/100)),H(e.member),z(e.member),E(e.author.id),c?.channelId===e.channel.id){async function P(e,t){return await new Promise(async s=>{let a="./data/AsakazeTakuma_Tandokuv1",i=function e(t){let s=iconv.decode(fs.readFileSync(t),"Shift_JIS").toString().split("\r\n").map(e=>{let t=e.split(","),s={};return s.name=t[0].split("=")[0],s.offset=parseFloat(t[1]),s.consonant=parseFloat(t[2]),s.cutOff=parseFloat(t[3]),s.preutter=parseFloat(t[4]),s.overlap=parseFloat(t[5]),s});return s}(path.join(a,"oto.ini")),n=await fetch(`http://localhost:50021/audio_query?text=${encodeURIComponent(e)}&speaker=11`,{method:"POST"}),r=await n.json(),o=[];for(let c in r.accent_phrases){let l=`./data/utautts/ATTD/output/${t}_${c}.wav`;await m(r.accent_phrases[c].moras,i,l,a),o.push(l),console.log(`#${parseInt(c)+1} audio saved at:`,l)}let d=ffmpeg();async function m(e,s,a,i){let n=path.join(__dirname,"data","utautts","ATTD","temp");fs.existsSync(n)||fs.mkdirSync(n);let r=B(e.map(e=>e.text).join("")),o=function e(t,s){let a=[];for(let i in t){let n="ぁぃぅぇぉゃゅょ".includes(t[parseInt(i)+1])?t.slice(i,parseInt(i)+2):t[i],r=s.find(e=>e.name.startsWith(n));r&&a.push(r.name)}return a}(r,s),c=[],l=0;for(let[d,m]of o.entries()){"っ"===r[d+l]&&c.push(path.join(__dirname,"data","240msNone.wav"));let u=path.join(i,m),g=path.join(n,`${t}_${d}.wav`),$=await h(u),p=Math.max(Math.min((e[d].consonant_length+e[d].vowel_length)*1500,Math.abs($+1.2*s.find(e=>e.name===m).cutOff)),180)+-(45*Math.random()+18)+(o.length-1===d)*120;await new Promise((t,a)=>{ffmpeg(u).setStartTime(s.find(e=>e.name===m).offset/1e3).setDuration(p/1e3).audioFilters([`asetrate=${44100*Math.max(1,1+(e[d].pitch-5)/3)}`,]).on("end",()=>{c.push(g),t()}).on("error",e=>a(e)).save(g)}),m.replace(".wav","").length>=2&&l++}await new Promise((e,t)=>{let s=ffmpeg();c.forEach(e=>s.input(e)),s.on("end",()=>{console.log("Audio synthesis complete!"),e()}).on("error",e=>t(e)).mergeToFile(a,n)}),c.forEach(e=>e.includes(path.join(__dirname,"data","utautts","ATTD","temp"))?fs.unlinkSync(e):null)}function h(e){return new Promise((t,s)=>{ffmpeg.ffprobe(e,(e,a)=>{if(e)s(e);else{let i=a.format.duration;t(1e3*i)}})})}o.forEach(e=>d.input(e),d.input("./data/750msNone.wav")),d.on("end",()=>{console.log("Audio merge complete!"),s(`./data/utautts/output/${t}.wav`)}).on("error",e=>console.error(e)).mergeToFile(`./data/utautts/output/${t}.wav`)})}let G=await K(e.content),J=G.length>150?G.slice(0,150)+"...以下省略":G;w(e.author.id),k(e.author.id,"tts",null),"AsakazeTakuma"===S(e.author.id).tts&&P(J,e.id).then(e=>{console.log(J),c.tracks.push(e),C(c),"idle"===m.state.status&&(console.log("idling now, trying to play a track"),console.log(fs.existsSync(c.tracks[c.np])),c.tracks[c.np]&&m.play($(c.tracks[c.np])))}),console.log(c.np),console.log(c.tracks,c.tracks[c.np])}}if("ft!info"!==e.content||e.author.bot||e.channel.send({content:`Ping\\: ${client.ws.ping}ms`}),!e.author.bot){if(e.member.roles.cache.has("1276543473083875410")){let W=y(e.member);if(!e.author.bot&&(w(e.author.id),!S(e.author.id).achievements.includes("ltsl"))){let Y=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"ltsl",W,Y,0,"common")}}if(e.member.roles.cache.has("1276542660315844728")){let X=y(e.member);if(!e.author.bot&&(w(e.author.id),!S(e.author.id).achievements.includes("ltsy"))){let Q=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"ltsy",X,Q,800,"uncommon")}}if(e.member.roles.cache.has("1275043743149326428")&&(e.content.includes("アスピッピミシミシガメ")||e.content.includes("しゅくな"))&&(e.member.roles.remove("1275043743149326428"),e.member.roles.add("1275649994384343153"),e.react("<:jasp:1275651728074739762>")),e.member.roles.cache.has("1275649994384343153")&&(e.content.includes("アスピッピミシミシガメ")||e.content.includes("しゅくな"))&&e.react("<:jasp:1275651728074739762>"),e.content.includes("アスピッピミシミシガメ")||e.content.includes("しゅくな"))try{let Z=y(e.member);if(!e.author.bot&&(w(e.author.id),!S(e.author.id).achievements.includes("jasp"))){let ee=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"jasp",Z,ee,0,"hidden")}}catch(et){er(et)}if(e.content.includes("j0.si"))try{let es=y(e.member);if(!e.author.bot){if(w(e.author.id),!S(e.author.id).achievements.includes("j0si")){let ea=e.member.roles.cache.has("1274646873889570887");el(e.author.id,es,ea)}j(e.author.id,80)}}catch(en){er(en)}if(e.content&&("1062340451966914580"===e.author.id||!e.author.bot)&&!e.member.roles.cache.has("1286857846423556206")&&"1227216489199960157"===e.channel.id){let eo=JSON.parse(fs.readFileSync("./htdocs/timeline/post.json")),ec={user:e.author.id,content:e.content,url:e.url,timestamp:e.createdTimestamp};try{e.attachments&&e.attachments.first()?.contentType?.startsWith("image")&&(ec.attachment=e.attachments.first().proxyURL)}catch(em){er(em)}eo.push(ec),eo.length>3&&eo.splice(0,1),console.log(eo),fs.writeFileSync("./htdocs/timeline/post.json",JSON.stringify(eo,null,"	"))}}if("1277136937869770752"===e.channelId&&e.author.bot&&"1264422349537546241"===e.author.id)try{if("send_notify"===e.content.split("/")[0]){let eh=await e.guild.members.fetch(e.content.split("/")[1]);eh.createDM(),await eh.send({embeds:e.embeds})}if("trend"===e.content.split("/")[0]){let eu=await e.guild.members.fetch(e.content.split("/")[1]);try{let eg=y(eu);if(!eu.user.bot){if(w(eu.user.id),!S(eu.user.id).achievements.includes("trend")){let e$=eu.roles.cache.has("1274646873889570887");x(eu.user.id,"trend",eg,e$,160,"common")}j(eu.id,50*(1+S(eu.user.id).glike/100))}}catch(ep){er(ep)}let e_=await t.channels.cache.get("1227216489199960157").messages.fetch(e.content.split("/")[2]);if(console.log(e_.content),void 0===e_.content){let ef=y(eu);if(!eu.user.bot&&(w(eu.user.id),!S(eu.user.id).achievements.includes("nocontenttrend"))){let e6=eu.roles.cache.has("1274646873889570887");x(eu.user.id,"nocontenttrend",ef,e6,240,"uncommon")}}if(!eu.user.bot&&!eu.roles.cache.has("1286857846423556206")){let e5=JSON.parse(fs.readFileSync("./htdocs/trend/post.json")),e0={user:eu.user.id,content:e_.content,url:e_.url,timestamp:e_.createdTimestamp};try{e_.attachments&&e_.attachments.first().contentType?.startsWith("image")&&(e0.attachment=e_.attachments.first().proxyURL)}catch(e4){er(e4)}e5.push(e0),console.log(e5),fs.writeFileSync("./htdocs/trend/post.json",JSON.stringify(e5,null,"	"))}}if("gave"===e.content.split("/")[0])try{let e2=await t.members.fetch(e.content.split("/")[1]),ey=await t.members.fetch(e.content.split("/")[2]),eb=parseInt(e.content.split("/")[3]),e3=parseInt(e.content.split("/")[4]);try{let e1=y(e2);if(y(ey),!e2.user.bot&&!ey.user.bot){if(w(e2.user.id),!S(e2.user.id).achievements.includes("coinsend")&&eb>=1){let ew=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"coinsend",e1,ew,30,"common")}if(!S(e2.user.id).achievements.includes("500coinsend")&&eb>=500){let e7=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"500coinsend",e1,e7,240,"uncommon")}if(!S(e2.user.id).achievements.includes("5kcoinsend")&&eb>=5e3){let e9=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"5kcoinsend",e1,e9,2e3,"uncommon")}if(!S(e2.user.id).achievements.includes("allsend")&&eb>=1&&0===e3){let eS=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"allsend",e1,eS,6400,"uncommon")}if(!S(e2.user.id).achievements.includes("10kcoinsend")&&eb>=1e4){let ev=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"10kcoinsend",e1,ev,6e3,"expert")}if(!S(e2.user.id).achievements.includes("sendaspoucoin")&&eb>=2413&&("726636661441560636"===ey.user.id||"1160169683304058961"===ey.user.id||"743372806661865472"===ey.user.id||"1163793435396935721"===ey.user.id)){let ek=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"sendaspoucoin",e1,ek,2413,"hidden")}let ex=100*ed(e2)+100;if(!S(e2.user.id).achievements.includes("sendnicewithfee")&&69===parseInt(eb*ex/100)){let ej=e2.roles.cache.has("1274646873889570887");x(e2.user.id,"sendnicewithfee",e1,ej,420,"hidden")}}}catch(eT){er(eT)}}catch(eI){er(eI)}let eq=e.content.split("/");if("cg"===eq[0]){let e8=await t.members.fetch(eq[1]),eF=(t.roles.cache.get(eq[2]),eq[3]),eC=y(e8);k(eq[1],"cghistory",[]);let eR=S(eq[1]);if(eR.cghistory.push(eq[2]),!S(eq[1]).achievements.includes("cgacha")){let eE=e8.roles.cache.has("1274646873889570887");x(eq[1],"cgacha",eC,eE,20,"common")}if(1===eF&&!S(eq[1]).achievements.includes("rcr")){let eN=e8.roles.cache.has("1274646873889570887");x(eq[1],"rcr",eC,eN,827,"expert")}if(2===eF&&!S(eq[1]).achievements.includes("scr")){let eM=e8.roles.cache.has("1274646873889570887");x(eq[1],"scr",eC,eM,5700,"legendary")}if(eR.cghistory.length>=3&&eR.cghistory.slice(-3).every(e=>e===eR.cghistory[eR.cghistory.length-1])){if(!S(eq[1]).achievements.includes("cgacha3same")){let eD=e8.roles.cache.has("1274646873889570887");x(eq[1],"cgacha3same",eC,eD,3200,"epic")}if(eR.cghistory.length>=5&&eR.cghistory.slice(-5).every(e=>e===eR.cghistory[eR.cghistory.length-1])&&!S(eq[1]).achievements.includes("cgacha5same")){let eL=e8.roles.cache.has("1274646873889570887");x(eq[1],"cgacha5same",eC,eL,12e3,"godlike")}}v(eq[1],"cghistory",eR.cghistory)}if("space"===eq[0]){let eA=eq[1],eU=await t.members.fetch(eA),eO=y(eU),eP=t.channels.cache.get(eq[2]);k(eA,"spaced",0);let eH=S(eA).spaced;if(eH++,v(eA,"spaced",eH),eH>=1&&!S(eq[1]).achievements.includes("1space")){let ez=eU.roles.cache.has("1274646873889570887");x(eq[1],"1space",eO,ez,72,"common")}if(eH>=10&&!S(eq[1]).achievements.includes("10space")){let eG=eU.roles.cache.has("1274646873889570887");x(eq[1],"10space",eO,eG,720,"uncommon")}j(eA,Math.random()*(3+eH)),"ja_jp"!==eO&&eP.setName(b("space.voice.title",eO).replace("<user>",L(eU.user.username,eO))),o.push({userId:eA,channelId:eq[2],nmsg:eq[3]})}if("c+"===eq[0]){let eJ=eq[1],eW=await t.members.fetch(eJ),eY=y(eW);eW.user.bot||w(eJ),k(eJ,"coinsEarned",0),k(eJ,"coinsSpent",0);let eB=S(eJ);if(eq[2]>=0?eB.coinsEarned+=parseInt(eq[2]):eB.coinsSpent+=parseInt(eq[2]),v(eJ,"coinsEarned",eB.coinsEarned),v(eJ,"coinsSpent",eB.coinsSpent),eq[3]>=1e4&&!S(eq[1]).achievements.includes("10kcoin")){let eK=eW.roles.cache.has("1274646873889570887");x(eq[1],"10kcoin",eY,eK,80,"uncommon")}}if("c-"===eq[0]){let eX=eq[1],eV=await t.members.fetch(eX);y(eV),eV.user.bot||w(eX),k(eX,"coinsEarned",0),k(eX,"coinsSpent",0);let eQ=S(eX);eq[2]>=0?eQ.coinsSpent+=parseInt(eq[2]):eQ.coinsEarned+=parseInt(eq[2]),v(eX,"coinsEarned",eQ.coinsEarned),v(eX,"coinsSpent",eQ.coinsSpent)}}catch(eZ){er(eZ)}if(e.content.includes("<@&1282255512913707039>"))try{if(console.log(e.reference),j(e.author.id,18),e.reference){let te=client.channels.cache.get(e.reference.channelId),tt=te.messages.cache.get(e.reference.messageId),ts=A(12),ta="filter:grayscale(1);";e.content.includes("color")&&(ta=ta.replace("filter:grayscale(1);",""));let ti="'Noto Sans JP', sans-serif";e.content.match(/font=\S+/i)&&(ti=td(e.content.match(/font=\S+/i)[0].replace("font=","")),console.log(ti)),"1227216489199960157"===tt.channelId||"1227231817346842635"===tt.channelId||"1275051364975775744"===tt.channelId?tl(tt,ts,ta,void 0,ti):e.reply({content:b("miaq.generating",y(e.member)),allowedMentions:{parse:[]}}).then(async e=>{tl(tt,ts,ta,e,ti)})}else{let tn=await e.channel.messages.fetch(e.channelId);if(console.log(e.channel.messages.fetch(e.channelId)),tn){let tr=A(12),to="filter:grayscale(1);";e.content.includes("color")&&(to=to.replace("filter:grayscale(1);",""));let tc="'Noto Sans JP', sans-serif";e.content.match(/font=\S+/i)&&(tc=td(e.content.match(/font=\S+/i)[0].replace("font=","")),console.log(tc)),e.reply({content:"Generating..."}).then(async e=>{tl(tn,tr,to,e,tc)})}}function tl(e,s,a,i,n){var r,o,c,l;nodeHtmlToImage({output:`./data/miaq/${s}.png`,html:`<html style="width:1200px;height:630px;overflow:hidden;"><head><link rel="stylesheet" href="./htdocs/trend/dhljt.css"><style>.small {font-size: 12px;color: gray;}h1, h2, h3 {line-height: 36px;margin-top: 0px;margin-bottom: 8px;}li {position: relative;}code {padding: 0 .2em;background-color: #2b2d30;border: solid #1e1f22 1px;border-radius: 4px;font-family: 'Consolas', 'Ubuntu Mono', monospace;}code.cb {padding: 5px;display: block;width: 100%;margin: 10px 0;margin-bottom: 3px;}pre {background-color: #2b2d30;width: 100%;margin: 0;}img.emoji {height: 1em;width: 1em;margin: 0 .05em 0 .1em;vertical-align: -0.1em;}.mention{background-color:#3c4270;color:#c9cdfb;padding:0 3px;border-radius:8px;transition:.15s ease-out;z-index:2}</style><script src="https://cdn.jsdelivr.net/npm/@twemoji/api@latest/dist/twemoji.min.js" crossorigin="anonymous"></script></head><body style="margin:0;width:1200px;height:630px"><div style="background-color:#000;width:1200px;height:630px"><img src="${e.member.avatarURL({size:1024})??e.author.displayAvatarURL({size:1024})}" style="width:630px;height:630px;transform:translateX(-64px);${a}"><div style="background: linear-gradient(90deg, rgba(0,0,0,0) 50%, rgba(0,0,0,1) 100%);width:480px;height:630px;transform:translate(90px,-100%)"></div><div style="color:#fff;transform:translate(640px,-970px);width:512px;height:630px;position:absolute;margin:0;font-family:${n??"'Noto Sans JP', sans-serif"};text-align:center;display:inline-block;"><div style="display:inline-block;top:50%;transform:translate(0,-50%);"></div><div style="transform:translateY(-50%)"><p style="font-size:40px;overflow-wrap:break-word;font-family:${n}", id="content">${(l=(c=(o=((r=e.content)+"").replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/^-# .+/gm,e=>`<span class="small">${e.slice(3,e.length)}</span>`).replace(/^### .+/gm,e=>`<h3>${e.slice(4,e.length)}</h3>`).replace(/^## .+/gm,e=>`<h2>${e.slice(3,e.length)}</h2>`).replace(/^# .+/gm,e=>`<h1>${e.slice(2,e.length)}</h1>`).replace(/^\s*- .+/gm,e=>{let t=Math.floor((e.match(/^\s*-/)[0].length-1)/2),s;return t>0&&(s="list-style-type: circle;"),`<li style="left: ${24*t}px;${s}">${e.replace(/^\s*- /,"")}</li>`}).replace(/^\s*\* .+/gm,e=>`<li style="left: ${24*Math.floor((e.match(/^\s*\*/)[0].length-1)/2)}px;">${e.replace(/^\s*\* /,"")}</li>`).replace(/\*\*[^\*]+\*\*/g,e=>`<strong>${e.slice(2,e.length-2)}</strong>`).replace(/\*[^\*]+\*/g,e=>`<i>${e.slice(1,e.length-1)}</i>`).replace(/__[^_]+__/g,e=>`<u>${e.slice(2,e.length-2)}</u>`).replace(/_[^_]+_/g,e=>`<i>${e.slice(1,e.length-1)}</i>`).replace(/~~[^~]+~~/g,e=>`<del>${e.slice(2,e.length-2)}</del>`).replace(/```(?:[^`]|`(?!``))*```/g,e=>{let t=e.replace(/`/g,"");return t.split("\n").length<2?`<code class="cb">${t}</code>`:""===t.split("\n")[0]?`<code class="cb">${t}</code>`:(console.log(t.replace(/^.+\n/,"")),`<pre><code class="language-${t.split("\n")[0]} theme-dark cb">${t.replace(/^.+\n/,"")}</code></pre>`)}).replace(/(`{1,2})[^`]+\1/g,e=>`<code>${e.replace(/`/g,"")}</code>`).replace(/\n|\r/g,"<br>").replace(/(<\/h[1-3]>|<\/li>)<br>/g,e=>e.slice(0,5)).replace(/\|\|[^\|]+\|\|/g,e=>`<span style="background-color:#1e1f22;border-radius:5px;box-shadow:0 0 1px;color:transparent;">${e.slice(2,e.length-2)}</span>`)).replace(/&lt;a?:\S+:\d+&gt;/g,e=>`<img src="https://cdn.discordapp.com/emojis/${e.match(/\d+/)[0]}" class="emoji">`)).replace(/&lt;@!?[^&]\d+&gt;/g,e=>{let s=t.members.cache.get(e.match(/\d+/)[0]),a=s?`@${s.displayName}`:`&lt;@${e.match(/\d+/)[0]}&gt;`;return`<span class="mention">${a}</span>`})}</p><p style="transform:translateY(-42px);font-size:20px;font-style:italic;font-weight:300;font-family:'Noto Sans JP', sans-serif" id="nm">- ${e.member.displayName}<br><span style="font-size:12px;color:#9f9f9f;font-weight:500;">@${e.author.username}</span></p></div></div></div><p style="font-size:14px;color:#8e8e8e;transform:translate(-10px,-40px);text-align:right;font-family:'Segoe UI',sans-serif">First Treron#4506, driplase</p></div><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script><script>twemoji.parse(document.getElementById('content'));twemoji.parse(document.getElementById('nm'));hljs.highlightAll();</script></body></html>`,transparent:!0,waitUntil:"load"}).then(async()=>{if(i){console.log("IMG_GEN_SUCCESS");let t=await new d().setName("miaq.png").setFile(`./data/miaq/${s}.png`);await i.edit({files:[t],content:""}).then(()=>fs.unlinkSync(`./data/miaq/${s}.png`))}else{console.log("IMG_GEN_SUCCESS");let a=await new d().setName("miaq.png").setFile(`./data/miaq/${s}.png`);V(e.channelId)?e.hasThread&&await e.thread.send({files:[a],content:""}).then(()=>fs.unlinkSync(`./data/miaq/${s}.png`)):await e.reply({files:[a],content:""}).then(()=>fs.unlinkSync(`./data/miaq/${s}.png`))}})}function td(e){let t=e.toLowerCase();if(t.match(/^notosans(jp|japanese)$/))return"'Noto Sans JP', sans-serif";if(t.match(/^notoserif(jp|japanese)$/))return"'Noto Serif JP', serif";if("hachimarupop"===t||"hmp"===t)return"'Hachi Maru pop'";if("consolas"===t||"monospace"===t)return"Consolas, monospace";if("inconsolata"===t)return"Inconsolata";else if("eclyera"===t)return"Eclyera";else if("opensans"===t)return"'Open Sans', sans-serif";else if("ubuntu"===t)return"Ubuntu";else if("mplus1p"===t||"mp1"===t)return"'M PLUS 1p'";else if("mplusrounded1c"===t||"mpr1"===t)return"Rounded Mplus 1c'";else return"'Noto Sans JP', sans-serif"}}catch(tm){er(tm)}if((e.mentions.users.has("1062340451966914580")||"1287434176945197099"===e.channelId)&&!e.content.match(/block(_|\\_)ai/gi)&&"1062340451966914580"!==e.author.id&&ei(e.content.replace("<@1062340451966914580>",""),e),!e.author.bot&&(w(e.author.id),k(e.author.id,"achievements",[]),e.member.roles.cache.has("1227622383100104705")&&!S(e.author.id).achievements.includes("beginning"))){let th=y(e.member),tu=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"beginning",th,tu,0,"common")}if(!e.author.bot){if(e.member.roles.cache.has("1276106622673879050")){let tg=y(e.member);if(w(e.author.id),!S(e.member.user.id).achievements.includes("rainbow")){let t$=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"rainbow",tg,t$,320,"legendary")}}if(e.member.roles.cache.has("1276096908242190407")){let tp=y(e.member);if(w(e.author.id),!S(e.author.id).achievements.includes("unsightreadable")){let t_=e.member.roles.cache.has("1274646873889570887");x(e.author.id,"unsightreadable",tp,t_,320,"legendary")}}}}),client.on("messageDelete",async e=>{try{try{if(!e.author.bot){w(e.author.id),k(e.author.id,"posts",0);let t=S(e.author.id).posts;t--,v(e.author.id,"posts",t),E(e.author.id)}}catch(s){er(s)}let a=fs.readFileSync("./data/ri.txt").toString().split("\n");for(;a.includes(e.id);)if(a[a.indexOf(e.id)-2].includes(",")&&!e.author.bot){let i=await e.channel.messages.fetch(a[a.indexOf(e.id)-1]);i.delete(),a=fs.readFileSync("./data/ri.txt").toString().replace(RegExp(`${a[a.indexOf(e.id)-2]}
${a[a.indexOf(e.id)-1]}
${a[a.indexOf(e.id)]}
`,"g"),""),fs.writeFileSync("./data/ri.txt",a)}}catch(n){er(n)}}),client.on("guildMemberUpdate",(e,t)=>{if(t.user.bot||(v(t.user.id,"roles",t.roles.cache.map(e=>e.id)),E(t.user.id)),e.roles.cache.has("1275649994384343153")){let s=t.roles.cache;console.log(s.has("1275043743149326428")||s.has("1274696519538180096")),(s.has("1275043743149326428")||s.has("1274696519538180096"))&&t.roles.remove("1275649994384343153")}if(!e.roles.cache.has("1227622383100104705")){let a=t.roles.cache;if(a.has("1227622383100104705")){try{t.user.bot}catch(i){er(i)}k(t.user.id,"achievements",[]);let n=y(t);if(!S(t.user.id).achievements.includes("beginning")){let r=t.roles.cache.has("1274646873889570887");x(t.user.id,"beginning",n,r,0,"common")}}}if(t.roles.cache.has("1276543473083875410")){let o=y(t);if(!t.user.bot&&(w(t.user.id),!S(t.user.id).achievements.includes("ltsl"))){let c=t.roles.cache.has("1274646873889570887");x(t.user.id,"ltsl",o,c,0,"common")}}if(t.roles.cache.has("1276542660315844728")){let l=y(t);if(!t.user.bot&&(w(t.user.id),!S(t.user.id).achievements.includes("ltsy"))){let d=t.roles.cache.has("1274646873889570887");x(t.user.id,"ltsy",l,d,800,"uncommon")}}if(t.roles.cache.has("1276106622673879050")){let m=y(t);if(!t.user.bot&&(w(t.user.id),!S(t.user.id).achievements.includes("rainbow"))){let h=t.roles.cache.has("1274646873889570887");x(t.user.id,"rainbow",m,h,320,"legendary")}}if(t.roles.cache.has("1276096908242190407")){let u=y(t);if(!t.user.bot&&(w(t.user.id),!S(t.user.id).achievements.includes("unsightreadable"))){let g=t.roles.cache.has("1274646873889570887");x(t.user.id,"unsightreadable",u,g,320,"legendary")}}}),client.on("guildMemberAdd",async e=>{e.user.bot||w(e.id);let a=S(e.id);if(a)for(let n=0;n<a?.roles?.length;n++)await e.roles.add(a.roles[n]);if(!e.user.bot&&e.guild.id===t.id){let r=s;s=await t.invites.fetch({cache:!1});let o=s.find(e=>r.get(e.code).uses<e?.uses),c=o.inviter;if(!c.bot){w(c.id),k(c.id,"invites",0);let l=S(c.id).invites;l++,v(c.id,"invites",l),v(e.user.id,"pendingInvite",c.id),w(e.user.id);let d=S(e.user.id).pendingInvite,m=S(d).invites;I(Math.round(d,100+10*Math.sqrt(5*m)+1.06**(m/1.5))),j(d,320*m),I(e.user.id,14)}}try{let h=fs.readFileSync(`../${J}/data.csv`).toString(),u=y(e);if(!RegExp(`^${e.id},-?\\d+$`,"gm").test(h)){await fs.appendFileSync(`../${J}/data.csv`,`${e.id},100
`),await e.roles.add("1227622383100104705");let g=[new i().setTitle(b("second.welcome",u)).setDescription(b("second.firstdm",u)).setColor(1874928),new i().setTitle(e.id)];await client.channels.cache.get("1277136937869770752").send({embeds:g,content:"sendEmbedDMX"})}}catch($){console.error($)}}),client.on("guildCreate",async e=>{io(`Joined a server: ${e.name} (${e.id})`),e.id!==guildId&&(io("THE SERVER WASN'T LIGHT TRERON\nleaving it..."),e.leave().then(()=>{io(`Leaved a server: ${e.name} (${e.id})`)}))}),client.on("voiceStateUpdate",async(e,t)=>{console.log("vsu");try{let s=[null,void 0,"1275333156366581820"];if(!t.member.user.bot){k(t.member.id,"vc",0);let a=S(t.member.id);if(s.includes(e.channel?.id)&&!s.includes(t.channel?.id))console.log("vcConnect"),-1===r.findIndex(e=>e.member.id===t.member.id)&&r.push({member:t.member,joined:new Date().getTime()});else if(!s.includes(e.channel?.id)&&s.includes(t.channel?.id)){console.log("vcDisconnect");let i=r.findIndex(e=>e.member.id===t.member.id);i>=0&&(()=>{let e=new Date().getTime(),s=(e-r[i].joined)/6e4;a.vc+=e-r[i].joined,j(t.member.id,35*(s-Math.sqrt(3*s+2.25))+52.5),v(t.member.id,"vc",a.vc),r.splice(i,1)})()}}console.log(r)}catch(n){er(n)}}),client.on("channelDelete",e=>{if(2===e.type){let s=o.findIndex(t=>t.channelId===e.id);s&&t.channels.cache.get("1227216489199960157").messages.cache.get(o[s].nmsg).delete().then(()=>{o.splice(s,1)})}}),setInterval(()=>{Math.random()>.73&&D(t.channels.cache.get("1227216489199960157"))},89716423),.008>Math.random()&&D(t.channels.cache.get("1227216489199960157"))}catch(U){er(U)}function O(e){let t=fs.readFileSync("./data/wht.txt").toString().split("\n");if(t.includes(e))return io("there's a webhook exists!"),t[t.indexOf(e)+1];io("no webhooks found from my webhook list...")}async function P(e){await e.createWebhook({name:"repyx"}).then(t=>(fs.appendFileSync("./data/wht.txt",`${e.id}
${t.url}
`),io(`created a webhook at ${e.id}`),t.url)).catch(console.error)}function H(e){try{let t=JSON.parse(fs.readFileSync("./htdocs/trend/user.json")),s=t[t.findIndex(t=>t.id===e.user.id)];if(s)s.username=e.user.username,s.avatar=e.avatarURL({size:64})??e.user.displayAvatarURL({size:64}),s.name=e.displayName;else{let a={id:e.user.id,username:e.user.username,avatar:e.avatarURL({size:64})??e.user.displayAvatarURL({size:64}),name:e.displayName};t.push(a)}fs.writeFileSync("./htdocs/trend/user.json",JSON.stringify(t,null,"	"))}catch(i){er(i)}}function z(e){k(e.id,"lastLogin",null),k(e.id,"loginStreak",0),k(e.id,"previousStreak",null),k(e.id,"longestStreak",0),k(e.id,"logged",1);let t=S(e.id),s=new Date;if(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0),t.lastLogin!==s.getTime()){if(t.lastLogin>=s.getTime()-864e5*(1+(X(e.id,"streakFreeze").count??0))&&t.lastLogin<=s.getTime()-864e5?(t.loginStreak++,t.logged++,t.loginStreak>=t.longestStreak&&(t.longestStreak=t.loginStreak),t.lastLogin<s.getTime()-864e5&&ea(e.id,"streakFreeze",(s.getTime()-t.lastLogin)/864e5-1),j(e.id,12.8*t.loginStreak),t.loginStreak>=30&&I(e.id,Math.round(64+320*t.loginStreak/Math.sqrt(3*t.loginStreak)))):(t.previousStreak=t.loginStreak,t.loginStreak=1),t.loginStreak>=7&&!S(e.id).achievements.includes("7day")){let a=y(e),i=e.roles.cache.has("1274646873889570887");x(e.id,"7day",a,i,420,"uncommon")}if(t.loginStreak>=14&&!S(e.id).achievements.includes("14day")){let n=y(e),r=e.roles.cache.has("1274646873889570887");x(e.id,"14day",n,r,3360,"expert")}if(t.loginStreak>=30&&!S(e.id).achievements.includes("30day")){let o=y(e),c=e.roles.cache.has("1274646873889570887");x(e.id,"30day",o,c,8390,"legendary")}t.lastLogin=s.getTime()}v(e.id,"loginStreak",t.loginStreak),v(e.id,"lastLogin",t.lastLogin),v(e.id,"previousStreak",t.previousStreak),v(e.id,"longestStreak",t.longestStreak),v(e.id,"logged",t.logged);let l=e.id;try{let d=JSON.parse(fs.readFileSync("./data/lb/streak.json")),m=d[d.findIndex(e=>e.id===l)];t.lbBanned||(m?(m.streak=t.loginStreak,m.l2=t.lastLogin,m.saves=X(l,"streakFreeze").count??0):d.push({id:l,streak:t.loginStreak,l2:t.lastLogin,saves:X(l,"streakFreeze").count??0}));for(let h=0;h<d.length;h++){let u=d[h];if(u.lastlogin<s.getTime()-864e5&&u.l2<s.getTime()-864e5){let g=X(u.id,"streakFreeze").count??0,$=(s.getTime()-t.lastLogin)/864e5-1;$>g?(ea(u.id,"streakFreeze",g),u.streak=0,u.saves=0):(ea(u.id,"streakFreeze",$),u.saves=g-$),u.l2=s.getTime()}}d.sort((e,t)=>t.streak-e.streak),console.log(d),fs.writeFileSync("./data/lb/streak.json",JSON.stringify(d,null,2))}catch(p){console.error(p)}}function W(e){return k(e,"items",[]),S(e).items}function X(e,t){let s=W(e).find(e=>e.id===t),a=s?s.count:0;return a>0&&s}function es(e,t,s){let a=W(e);if(X(e,t)){let i=a.find(e=>e.id===t);i.count+=s??1}else a.push({id:t,count:s??1});v(e,"items",a)}function ea(e,t,s){let a=W(e),i=X(e,t);if(!i||!(i.count>=s))return!1;{let n=a.find(e=>e.id===t);return n.count-=s??1,v(e,"items",a),!0}}async function ei(e,t){let s=[],a=[],i=t;for(;i.reference;){i=await i.fetchReference();try{a.push(await i.content.replace(`
-# _${b("ftai.footer",y(t.member))}_`,""))}catch(n){er(n)}}if(a.reverse(),console.log(a),a.length>0)for(let r=0;r<a.length;r++){let o;o=r%2?"model":"user",s.push({role:o,parts:[{text:a[r]}]})}t.reply(`-# _${b("ftai.generating",y(t.member))}_`).then(async a=>{console.log(s);let i=model.startChat({generationConfig,safetySettings:safetySettings,history:s});try{let n=await i.sendMessage(e),r=await n.response.text();await r.length<1&&(r="..."),a.edit({content:`${await r}
-# _${b("ftai.footer",y(t.member))}_`}),j(t.author.id,r.length/2)}catch(o){er(o),a.edit({content:`-# _${b("ftai.fail",y(t.member))}_
-# \`\`\`${o}\`\`\``})}})}ec(),setInterval(ec,9e4),setInterval(()=>{changeRate("100")},100)}catch(en){er(en)}function eo(){if(5===client.ws.status)try{client.login(_)}catch(e){console.log(e)}try{client.user.setPresence({activities:[{name:`[${Math.round((new Date().getTime()-tms)/36e4)/10}h] Ping: ${client.ws.ping}ms`,type:4}],status:n.DoNotDisturb})}catch(t){console.log(t)}}function ec(){try{let e=parseFloat(fs.readFileSync("./data/r2.txt"));t.roles.cache.get("1276106622673879050").setColor(hsvToHex(e/100,.46,1)),(e+=4)>100&&(e=0),fs.writeFileSync("./data/r2.txt",e.toString())}catch(s){er(s)}}async function el(e,t,s){let a=await getRequest({url:"https://www.gaitameonline.com/rateaj/getrate",json:!0}),i=a.quotes.find(e=>"USDJPY"===e.currencyPairCode).ask,n=Math.round(1589*parseFloat(i)/100);x(e,"j0si",t,s,n,"hidden")}function ed(e){return e.roles.cache.has("1276542660315844728")?0:e.roles.cache.has("1276543473083875410")?.05:.1}}),client.login(_);